<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>–°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤</title>
  <meta charset="UTF-8" />
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <style>
    /* –¢–≤–æ–∏ —Å—Ç–∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    h1 { margin-bottom: 20px; }
    .post {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
    }
    .post h2 { margin: 0 0 10px; }
    .post p { white-space: pre-wrap; }
    a { text-decoration: none; }
    a:hover { text-decoration: underline; }
    .like-dislike-buttons {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }
    .like-dislike-buttons button {
      background-color: #f0f0f0;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .like-dislike-buttons button:hover {
      background-color: #e0e0e0;
    }
    .comments-section {
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
    }
    .comments-section h3 {
      margin-bottom: 10px;
    }
    .comment {
      border-top: 1px solid #eee;
      padding: 8px 0;
    }
    .comment:first-child {
      border-top: none;
    }
    .comment strong {
      font-weight: 600;
    }
    textarea {
      width: 100%;
      height: 60px;
      resize: vertical;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 8px;
      font-family: inherit;
      font-size: 14px;
    }
    input[type="text"] {
      margin-top: 5px;
      width: 200px;
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .comment-form button {
      margin-top: 8px;
      padding: 6px 12px;
      border: none;
      background-color: #1976d2;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .comment-form button:hover {
      background-color: #115293;
    }
  </style>
</head>
<body>
<div class="sidebar">
  <h2><a th:href="@{/hello}">–ì–ª–∞–≤–Ω–∞—è</a></h2>
  <ul>
    <li><a th:href="@{/posts/create}">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a></li>
    <li><a th:href="@{/posts}">–ü–æ—Å—Ç—ã</a></li>
    <li><a th:href="@{/contact}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
    <form th:action="@{/logout}" method="post">
      <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <input type="submit" value="Sign Out"/>
    </form>
  </ul>
</div>

<div class="main">
  <h1>–ü–æ—Å—Ç—ã</h1>

  <form action="/posts/search" method="get">
    <input type="text" name="query" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ø–æ—Å—Ç–∞–º" required>
    <button type="submit">–ü–æ–∏—Å–∫</button>
  </form>

  <a href="/posts/create" style="margin-left: 45%">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</a>

  <div th:if="${posts.isEmpty()}">
    <p style="margin-left: 45%">–ü–æ—Å—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
  </div>

  <div th:each="post : ${posts}" class="post">
    <h2 th:text="${post.title}">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h2>
    <p th:text="${post.content}">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</p>
    <p>–ê–≤—Ç–æ—Ä: <span th:text="${post.author}">–ê–≤—Ç–æ—Ä</span></p>

    <div class="comments-section">
      <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>

      <div th:if="${post.comments != null and !post.comments.isEmpty()}">
        <div th:each="comment : ${post.comments}" class="comment">
          <p><strong th:text="${comment.author}">–ê–≤—Ç–æ—Ä</strong> –Ω–∞–ø–∏—Å–∞–ª(–∞):</p>
          <p th:text="${comment.content != null ? comment.content : comment.text}">–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è</p>
        </div>
      </div>

      <div th:if="${post.comments == null or post.comments.isEmpty()}">
        <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
      </div>

      <form th:action="@{/api/comments}" method="post" class="comment-form">
        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <input type="hidden" name="postId" th:value="${post.id}" />
        <textarea name="content" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" required></textarea>
        <br/>
        <input type="text" name="author" placeholder="–í–∞—à–µ –∏–º—è" required>
        <br/>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
      </form>
    </div>

    <form th:action="@{'/posts/delete/' + ${post.id}}" method="post" class="delete-form">
      <input type="hidden" name="_method" value="delete"/>
      <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <button type="submit" class="delete-button"
              onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?');">–£–¥–∞–ª–∏—Ç—å</button>
    </form>

    <div class="like-dislike-buttons">
      <form th:action="@{/posts/{id}/like(id=${post.id})}" method="post">
        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit">üëç Like (<span th:text="${post.likes}">0</span>)</button>
      </form>

      <form th:action="@{/posts/{id}/dislike(id=${post.id})}" method="post">
        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit">üëé Dislike (<span th:text="${post.dislikes}">0</span>)</button>
      </form>
    </div>
  </div>
</div>
</body>
</html>
